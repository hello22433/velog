<h2 id="초록abstract">초록(Abstract)</h2>
<p>여러 사람이 동시에 하나의 중요한 자원을 사용하려 할 때, 충돌을 막기 위해 “락(Lock)”이라는 방법이 사용된다.
이 글은 데이터베이스(Database)가 아닌 <strong>애플리케이션(프로그램) 수준에서 락을 거는 방식</strong>이 왜 유용한지를 설명한다.
특히, 복잡한 컴퓨터 용어 대신 <strong>학교, 도서관, 놀이기구 같은 일상적인 예시</strong>를 통해 애플리케이션 레벨 락의 장점을 명확히 보여주는 것을 목표로 한다.</p>
<hr />
<h2 id="1-문제-정의-왜-락이-필요한가">1. 문제 정의: 왜 락이 필요한가?</h2>
<h3 id="11-동시에-하면-안-되는-일">1.1 동시에 하면 안 되는 일</h3>
<p>초등학교에서 이런 상황을 생각해보자.</p>
<ul>
<li>급식실에 <strong>우유가 1개</strong> 남아 있다.</li>
<li>친구 두 명이 <strong>거의 동시에</strong> 우유를 집으러 달려간다.</li>
</ul>
<p>아무 규칙이 없다면,</p>
<ul>
<li>둘 다 “내가 먼저야!”라고 말하게 된다.</li>
<li>결국 싸움이 난다.</li>
</ul>
<p>컴퓨터에서도 똑같은 일이 일어난다.</p>
<ul>
<li>돈</li>
<li>재고</li>
<li>점수</li>
<li>좌석 수</li>
</ul>
<p>같이 <strong>중요하고 하나뿐인 것</strong>을
여러 요청이 동시에 바꾸려고 하면 문제가 생긴다.</p>
<p>이 문제를 막는 규칙이 바로 <strong>락(Lock)</strong>이다.</p>
<hr />
<h2 id="2-기존-방법-데이터베이스-락의-한계">2. 기존 방법: 데이터베이스 락의 한계</h2>
<h3 id="21-db-락이란">2.1 DB 락이란?</h3>
<p>DB 락은 이렇게 동작한다.</p>
<blockquote>
<p>“지금 이 데이터는 내가 쓰는 중이야.
끝날 때까지 아무도 건드리지 마.”</p>
</blockquote>
<p>비유하면,</p>
<ul>
<li>도서관 책에 자물쇠를 채우고</li>
<li>사서만 열 수 있게 한 것</li>
</ul>
<h3 id="22-문제점">2.2 문제점</h3>
<p>하지만 DB 락에는 단점이 있다.</p>
<ol>
<li><p><strong>느리다</strong></p>
<ul>
<li>책에 자물쇠를 채우고 푸는 데 시간이 걸린다.</li>
</ul>
</li>
<li><p><strong>오래 잡고 있으면 모두 기다려야 한다</strong></p>
<ul>
<li>화장실에서 누가 오래 안 나오면, 줄이 길어지는 것과 같다.</li>
</ul>
</li>
<li><p><strong>책 밖에서 일어나는 일은 막지 못한다</strong></p>
<ul>
<li>책을 들고 밖에 나가서 친구랑 이야기하는 시간은 통제 불가</li>
</ul>
</li>
</ol>
<p>즉, DB 락은
<strong>“데이터베이스 안에서만”</strong> 일어나는 일만 지킬 수 있다.</p>
<hr />
<h2 id="3-제안-방법-애플리케이션-레벨-락">3. 제안 방법: 애플리케이션 레벨 락</h2>
<h3 id="31-애플리케이션-락이란">3.1 애플리케이션 락이란?</h3>
<p>애플리케이션 레벨 락은 이렇게 생각하면 된다.</p>
<blockquote>
<p>“중요한 일을 하기 전에
선생님께 허락부터 받고 시작하자.”</p>
</blockquote>
<p>즉,</p>
<ul>
<li>DB에 가기 전에</li>
<li>프로그램이 먼저 질서를 잡는다</li>
</ul>
<hr />
<h2 id="4-애플리케이션-레벨-락의-장점">4. 애플리케이션 레벨 락의 장점</h2>
<h3 id="41-장점-1-db가-힘들지-않다-부하-감소">4.1 장점 1: DB가 힘들지 않다 (부하 감소)</h3>
<p>비유로 설명해보자.</p>
<ul>
<li>DB = 급식실 조리사</li>
<li>요청 = 학생들</li>
</ul>
<p>모든 학생이 조리사에게 직접 달려가면,
조리사는 너무 바쁘다.</p>
<p>애플리케이션 락은:</p>
<ul>
<li>교실에서 줄부터 세우고</li>
<li>한 명씩 급식실로 보낸다</li>
</ul>
<p>그래서:</p>
<ul>
<li>DB는 덜 피곤하다</li>
<li>서비스가 더 빨라진다</li>
</ul>
<hr />
<h3 id="42-장점-2-더-넓은-범위를-보호할-수-있다">4.2 장점 2: 더 넓은 범위를 보호할 수 있다</h3>
<p>DB 락은 이런 것만 지킨다.</p>
<ul>
<li>“책을 쓰는 시간”</li>
</ul>
<p>하지만 실제로는:</p>
<ul>
<li>계산하기</li>
<li>선생님에게 물어보기</li>
<li>다른 반에 연락하기</li>
</ul>
<p>같은 일이 함께 일어난다.</p>
<p>애플리케이션 락은:</p>
<blockquote>
<p>“이 숙제가 끝날 때까지는
오직 한 명만 하자”</p>
</blockquote>
<p>처럼 <strong>전체 과정</strong>을 보호할 수 있다.</p>
<hr />
<h3 id="43-장점-3-의미-있는-기준으로-락을-걸-수-있다">4.3 장점 3: 의미 있는 기준으로 락을 걸 수 있다</h3>
<p>DB는 이렇게 생각한다.</p>
<ul>
<li>이 줄(row)</li>
<li>이 표(table)</li>
</ul>
<p>하지만 사람은 이렇게 생각한다.</p>
<ul>
<li>이 학생</li>
<li>이 계좌</li>
<li>이 주문</li>
</ul>
<p>애플리케이션 락은:</p>
<ul>
<li>“철수의 통장”</li>
<li>“3번 놀이기구”</li>
<li>“오늘의 마지막 자리”</li>
</ul>
<p>같이 <strong>사람이 이해하는 기준</strong>으로 락을 건다.</p>
<p>그래서:</p>
<ul>
<li>필요 없는 사람은 기다리지 않아도 된다</li>
<li>더 공평하다</li>
</ul>
<hr />
<h3 id="44-장점-4-실패해도-친절하게-대응-가능">4.4 장점 4: 실패해도 친절하게 대응 가능</h3>
<p>DB 락 실패는 보통 이렇게 끝난다.</p>
<ul>
<li>에러</li>
<li>실패</li>
<li>다시 시도</li>
</ul>
<p>애플리케이션 락은 다르다.</p>
<ul>
<li>“지금은 사용 중이에요”</li>
<li>“잠시 후 다시 와 주세요”</li>
<li>“대기 줄에 넣어 드릴게요”</li>
</ul>
<p>즉, <strong>사람에게 설명할 수 있는 방식</strong>으로 실패를 처리할 수 있다.</p>
<hr />
<h3 id="45-장점-5-구조가-바뀌어도-계속-쓸-수-있다">4.5 장점 5: 구조가 바뀌어도 계속 쓸 수 있다</h3>
<p>학교가 커져서:</p>
<ul>
<li>반이 늘어나고</li>
<li>건물이 나뉘어도</li>
</ul>
<p>“차례대로 하자”라는 규칙은 그대로다.</p>
<p>애플리케이션 락도 마찬가지다.</p>
<ul>
<li>DB가 바뀌어도</li>
<li>서버가 여러 대가 되어도</li>
</ul>
<p>규칙은 유지된다.</p>
<hr />
<h2 id="5-종합-비교">5. 종합 비교</h2>
<table>
<thead>
<tr>
<th>구분</th>
<th>DB 락</th>
<th>애플리케이션 락</th>
</tr>
</thead>
<tbody><tr>
<td>위치</td>
<td>DB 안</td>
<td>프로그램 앞</td>
</tr>
<tr>
<td>보호 범위</td>
<td>데이터만</td>
<td>전체 과정</td>
</tr>
<tr>
<td>이해하기</td>
<td>어려움</td>
<td>쉬움</td>
</tr>
<tr>
<td>사용자 안내</td>
<td>불가능</td>
<td>가능</td>
</tr>
<tr>
<td>확장성</td>
<td>낮음</td>
<td>높음</td>
</tr>
</tbody></table>
<hr />
<h2 id="6-결론">6. 결론</h2>
<p>애플리케이션 레벨 락은
단순히 “기술적으로 좋은 방법”이 아니다.</p>
<p>그 본질은 다음과 같다.</p>
<blockquote>
<p><strong>컴퓨터에게 질서를 맡기기 전에
사람이 이해할 수 있는 규칙을 먼저 세우는 것</strong></p>
</blockquote>
<p>그래서:</p>
<ul>
<li>더 빠르고</li>
<li>더 안전하며</li>
<li>더 친절한 시스템을 만들 수 있다.</li>
</ul>
<hr />
<h2 id="한-문장-요약">한 문장 요약</h2>
<blockquote>
<p><strong>애플리케이션 레벨 락은
“중요한 일을 하기 전에, 사람처럼 차례를 정하는 방법”이다.</strong></p>
</blockquote>
<hr />
<h2 id="7-실제-용례use-cases-애플리케이션-레벨-락은-어디서-쓰이나">7. 실제 용례(Use Cases): 애플리케이션 레벨 락은 어디서 쓰이나?</h2>
<p>이 장에서는
“그래서 이걸 <strong>진짜 어디에 쓰는데?</strong>”
라는 질문에 답한다.</p>
<hr />
<h2 id="71-선착순-이벤트-쿠폰-티켓-좌석">7.1 선착순 이벤트 (쿠폰, 티켓, 좌석)</h2>
<h3 id="상황-설명">상황 설명</h3>
<ul>
<li>쿠폰이 <strong>100장</strong> 있다.</li>
<li>동시에 <strong>1,000명</strong>이 버튼을 누른다.</li>
</ul>
<h3 id="락이-없으면">락이 없으면?</h3>
<ul>
<li><p>모두 “아직 남아 있어!”라고 판단</p>
</li>
<li><p>결과:</p>
<ul>
<li>100장보다 많이 발급됨</li>
<li>나중에 회수하거나 사과해야 함</li>
</ul>
</li>
</ul>
<h3 id="애플리케이션-레벨-락-사용">애플리케이션 레벨 락 사용</h3>
<p>비유로 보면:</p>
<blockquote>
<p>“쿠폰 창구 앞에
한 줄로 서게 만든다”</p>
</blockquote>
<p>동작 방식:</p>
<ol>
<li>“쿠폰 발급” 요청이 들어온다</li>
<li>애플리케이션이
<code>coupon-event-2025</code> 라는 락을 잡는다</li>
<li>수량 확인</li>
<li>발급</li>
<li>락 해제</li>
</ol>
<h3 id="왜-db-락보다-좋은가">왜 DB 락보다 좋은가?</h3>
<ul>
<li>DB에 가기 전에 줄을 세움</li>
<li>“이미 끝났어요”를 바로 알려줄 수 있음</li>
<li>서버가 여러 대여도 동일한 규칙 유지</li>
</ul>
<p>👉 <strong>대부분의 선착순 이벤트는 애플리케이션 락이 필수</strong></p>
<hr />
<h2 id="72-계좌-이체--포인트-차감">7.2 계좌 이체 / 포인트 차감</h2>
<h3 id="상황-설명-1">상황 설명</h3>
<ul>
<li><p>철수의 통장에 <strong>10,000원</strong></p>
</li>
<li><p>동시에:</p>
<ul>
<li>편의점 결제 8,000원</li>
<li>온라인 결제 5,000원</li>
</ul>
</li>
</ul>
<h3 id="락이-없으면-1">락이 없으면?</h3>
<ul>
<li><p>두 요청 모두:</p>
<ul>
<li>“아직 돈이 있네?”</li>
</ul>
</li>
<li><p>결과:</p>
<ul>
<li>잔액이 마이너스</li>
<li>금융 사고</li>
</ul>
</li>
</ul>
<h3 id="애플리케이션-레벨-락-사용-1">애플리케이션 레벨 락 사용</h3>
<p>비유:</p>
<blockquote>
<p>“철수의 통장은
한 번에 한 사람만 열 수 있다”</p>
</blockquote>
<p>락 기준:</p>
<pre><code>lock(&quot;account:철수&quot;)</code></pre><p>이렇게 하면:</p>
<ul>
<li>한 결제가 끝날 때까지</li>
<li>다른 결제는 기다리거나 실패</li>
</ul>
<h3 id="중요한-포인트">중요한 포인트</h3>
<ul>
<li><p>DB row 락은 <strong>돈을 빼는 순간</strong>만 보호</p>
</li>
<li><p>애플리케이션 락은:</p>
<ul>
<li>잔액 확인</li>
<li>계산</li>
<li>차감</li>
<li>로그 기록
👉 <strong>전체 과정 보호</strong></li>
</ul>
</li>
</ul>
<hr />
<h2 id="73-재고-관리-쇼핑몰">7.3 재고 관리 (쇼핑몰)</h2>
<h3 id="상황-설명-2">상황 설명</h3>
<ul>
<li>인기 운동화 재고: <strong>1개</strong></li>
<li>동시에 두 명이 “구매하기” 클릭</li>
</ul>
<h3 id="db-락만-쓰는-경우">DB 락만 쓰는 경우</h3>
<ul>
<li>트랜잭션이 길어짐</li>
<li>결제 API 호출 중에도 DB 락 유지</li>
<li>다른 요청들이 전부 대기</li>
</ul>
<h3 id="애플리케이션-레벨-락-사용-2">애플리케이션 레벨 락 사용</h3>
<p>비유:</p>
<blockquote>
<p>“신발 상자를 먼저 잡은 사람만
계산대로 간다”</p>
</blockquote>
<p>동작 흐름:</p>
<ol>
<li><code>product:운동화-270</code> 락 획득</li>
<li>재고 확인</li>
<li>결제 진행</li>
<li>재고 감소</li>
<li>락 해제</li>
</ol>
<h3 id="결과">결과</h3>
<ul>
<li>불필요한 DB 대기 감소</li>
<li>“이미 판매되었습니다”를 빠르게 응답</li>
<li>시스템 전체가 안정적</li>
</ul>
<hr />
<h2 id="74-중복-요청-방지-버튼-연타-문제">7.4 중복 요청 방지 (버튼 연타 문제)</h2>
<h3 id="상황-설명-3">상황 설명</h3>
<ul>
<li>사용자가 결제 버튼을 <strong>10번 연속 클릭</strong></li>
</ul>
<h3 id="락이-없으면-2">락이 없으면?</h3>
<ul>
<li>주문 10개 생성</li>
<li>결제 10번 시도</li>
<li>고객센터 폭발</li>
</ul>
<h3 id="애플리케이션-레벨-락-사용-3">애플리케이션 레벨 락 사용</h3>
<p>비유:</p>
<blockquote>
<p>“이미 주문 중이면
버튼을 잠근다”</p>
</blockquote>
<p>락 기준 예시:</p>
<pre><code>lock(&quot;order:create:user123&quot;)</code></pre><p>이렇게 하면:</p>
<ul>
<li><p>첫 요청만 처리</p>
</li>
<li><p>나머지는:</p>
<ul>
<li>무시</li>
<li>또는 “처리 중입니다” 안내</li>
</ul>
</li>
</ul>
<hr />
<h2 id="75-배치-작업--정산-작업">7.5 배치 작업 / 정산 작업</h2>
<h3 id="상황-설명-4">상황 설명</h3>
<ul>
<li>매일 밤 12시에 정산 프로그램 실행</li>
<li>서버가 여러 대라서
<strong>여러 개가 동시에 실행될 수 있음</strong></li>
</ul>
<h3 id="문제">문제</h3>
<ul>
<li>정산이 두 번 실행됨</li>
<li>금액이 두 배로 계산됨</li>
</ul>
<h3 id="애플리케이션-레벨-락-사용-4">애플리케이션 레벨 락 사용</h3>
<p>비유:</p>
<blockquote>
<p>“오늘 정산은
이미 누가 하고 있으면
다른 사람은 집에 간다”</p>
</blockquote>
<p>락 예시:</p>
<pre><code>lock(&quot;daily-settlement:2025-12-21&quot;)</code></pre><h3 id="효과">효과</h3>
<ul>
<li>하루에 한 번만 실행 보장</li>
<li>서버 수와 무관하게 안전</li>
</ul>
<hr />
<h2 id="8-왜-현실-서비스는-애플리케이션-락을-선택하는가">8. 왜 ‘현실 서비스’는 애플리케이션 락을 선택하는가</h2>
<p>정리하면 다음 때문이다.</p>
<ol>
<li>사람 기준으로 생각할 수 있다</li>
<li>DB를 괴롭히지 않는다</li>
<li>전체 흐름을 보호한다</li>
<li>실패해도 친절하다</li>
<li>서버가 늘어나도 유지된다</li>
</ol>
<hr />
<h2 id="최종-결론-확장">최종 결론 (확장)</h2>
<blockquote>
<p>애플리케이션 레벨 락은
단순한 기술이 아니라
<strong>현실 세계의 “줄 서기 규칙”을
컴퓨터에 그대로 옮긴 것이다.</strong></p>
</blockquote>
<p>그래서:</p>
<ul>
<li>돈</li>
<li>재고</li>
<li>기회</li>
<li>순서</li>
</ul>
<p>처럼 <strong>싸움이 나기 쉬운 문제</strong>에서
가장 먼저 고려되는 해결책이 된다.</p>
<hr />